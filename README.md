# checkout.com Devops Challenge

## Prerequisites
- AWS CLI: https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
- Permissions in AWS to create resources and configured: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html

## Basic Website (static)
The website is generated by running the script: `cloudformation.sh` which deploys a CloudFormation stack using `cloudformation.json` as a template.
All resources are created in the `eu-west-1` region. `cloudformation.sh` takes parameters:
- `SiteName` (required); which must be globally unique.
- `UploadUser` (optional); if set to `True` creates an IAM user with credentials that may be added to repository secrets to enable Github Actions Workflow for assets upload.
- `HostedZoneId` (optional); if set, creates a Route53 DNS record for `<SiteName>.com` in a pre-existing hosted zone named `<SiteName>.com`. The domain `<SiteName>.com` must first be registered with Route53 with a Hosted Zone created, see: https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html
- `SiteType` (optional); accepted values are `S3` or `CloudFront`. `S3` site will expose a public S3 site on HTTP, `CloudFront` site will use HTTPS with private S3. A `CloudFront` site requires `HostedZoneId` to be configured.

For example, to create a basic HTTP S3 site: `./cloudformation.sh False checkout_com-devops-challenge`

For a HTTPS website served via CloudFront: `./cloudformation.sh True checkout_com-devop-challenge Z8VLZEXAMPLE CloudFront`

### Upload User - Github Actions
If `UploadUser` is set to `True`, then an AWS IAM User will be created that can be configured in Github Repository Secrets: https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository
If not set to `True`, then assets will be uploaded as part of the `cloudformation.sh` script.
The Github Actions Workflow will upload assets to S3, currently the S3 Bucket Name is hardcoded. Secrets generated by CloudFormation, required by the Github Workflow are:
- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`

For additional protection, Github Secrets can be restricted to specific branches using environment secrets instead: https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#environment-secrets

### Site Type - S3
By default, this cloudformation stack creates a S3 hosted site. This offers a http endpoint where basic site logic is available.
This endpoint is given as `WebsiteURL` in the Cloudformation Outputs, and is of the format: `http://<SiteName>.s3-website-<region>.amazonaws.com`
If `HostedZoneId` is set, then the endpoint will be of the form `<SiteName>.com`

The index page of the website can be directly access via a https endpoint.
This endpoint is given as `S3BucketSecureURL` in the Cloudformation Outputs, and is of the format: `https://<SiteName>.s3.amazonaws.com/index.html`

Access Logs to assets hosted in S3 are pushed to a logging bucket: `<SiteName>-logs`. These can be analysed using tools such as Amazon Athena

#### S3 Public Access
If you block all public access at the account level, Amazon S3 will continue to block public access to the bucket.
In this scenario, you would have to edit your account-level Block Public Access settings.
https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html

### Site Type - CloudFront
Note that this deployment requires a certificate to be created in the `us-east-1` region first. The `cloudformation.sh` script is able to handle this, but will need to be run at least twice to pick up the certificate ARN.
Site assets remain hosted in S3, but the S3 bucket itself is now private. Instead access is only through a HTTPS endpoint `<SiteName>.com` via CloudFront.

S3 and CloudFront Access Logs to assets are pushed to a logging bucket: `<SiteName>-logs`. These can be analysed using tools such as Amazon Athena

## Challenge Results
Challenge site (CloudFront type): https://checkout-devops-challenge.com/
- Scaling: The site uses serverless technologies and as such should scale automatically to any user load
- Dynamic hosting: This site is not dynamic. There are multiple methods of introducing dynamic elements that could add to this architecture, such as using Lambda, ALBs, or API Gateway as additional origins.

### Further monitoring or alerting
CloudFront Error rate metrics are not supported by CloudFormation, but can be configured with Custom Resources, or Terraform. CloudWatch Alarms, and further alerting with SNS, can then be configured based on these metrics.
CloudFront real-time logging is not configured here, but can be enabled to forward real-time logs, via Amazin Kinesis, to a monitoring service such as DataDog.
